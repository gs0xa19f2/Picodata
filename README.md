# Picodata: rest-countries-plugin

Учебный репозиторий: плагин-кеш для Picodata, реализующий хранение информации о странах, получаемой через внешний REST API.

---

## Описание

**rest-countries-plugin** — пример плагина на Rust для in-memory СУБД [Picodata](https://picodata.io/), который реализует:
- Кеширование данных о странах, запрошенных через REST API [restcountries.com](https://restcountries.com/)
- Быстрый доступ к информации по стране через собственный HTTP endpoint
- Фоновую очистку устаревших записей (TTL)
- Гибкую конфигурируемость (URL-источника, время жизни кеша)
- Тестирование типовых сценариев работы и ошибок

Плагин демонстрирует работу с Picodata Plugin SDK, асинхронные запросы, управление фоновыми задачами, обработку ошибок и написание тестов.

---

## Архитектура и основные компоненты

- **lib.rs** — точка входа, описание сервиса, endpoints, кеш, регистрация фоновых задач, обработка ошибок
- **restcountries.rs** — запросы к внешнему REST API, обработка ответов и ошибок
- **ttl.rs** — фоновая задача очистки устаревших кеш-записей по TTL
- **migrations/0001_countries.db** — создание таблицы для хранения кэша стран
- **tests/** — юнит- и интеграционные тесты:
  - Проверка кеширования и повторного доступа (cache hit/miss)
  - Проверка очистки по TTL
  - Проверка обработки ошибок API и валидации запросов

---

## Краткая схема работы

1. **Запрос информации о стране**  
   - GET `/name?name=<country>`  
   - Если страна есть в кеше — возвращается кэшированный ответ (cache hit)
   - Если нет — плагин обращается к внешнему API, сохраняет результат в кеш асинхронно и возвращает его клиенту (cache miss)

2. **Кеширование и TTL**  
   - Каждая запись в кеш снабжается временем создания
   - Фоновая задача периодически удаляет устаревшие записи (TTL настраивается)

3. **Обработка ошибок**  
   - Корректно возвращаются ошибки валидации (например, пустое имя страны) и ошибки от upstream API

